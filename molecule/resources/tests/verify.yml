
- name: Verify
  hosts: all
  gather_facts: false
  vars:
    vector_config: /etc/vector/config.yaml
  tasks:
  - name: Validate vector config
    ansible.builtin.command: vector validate "{{ vector_config }}"
    register: validation_status
  - name: Verify vector validation status
    assert:
      that:
        -  validation_status.rc == 0
  - name: collect facts about system services
    ansible.builtin.service_facts:
    register: services_state
  - name: Verify vector systemd unit status
    assert:
      that:
        - services_state['services']['vector.service']['status'] == 'enabled'
  - name: Verify vector systemd unit state
    assert:
      that:
        - services_state['services']['vector.service']['state'] == 'running'